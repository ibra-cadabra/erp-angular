<mat-card class="tech-card">
  <mat-card-title>üë∑ Ajouter ou Modifier un nouveau Technicien</mat-card-title>

  <form [formGroup]="form" (ngSubmit)="submit()" class="form-grid">

    <!-- NOM & PR√âNOM -->
    <mat-form-field appearance="outline">
      <mat-label>Nom</mat-label>
      <input matInput formControlName="name" />
      <mat-error *ngIf="form.get('name')?.hasError('required')">Nom requis</mat-error>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Pr√©nom</mat-label>
      <input matInput formControlName="prename" />
      <mat-error *ngIf="form.get('prename')?.hasError('required')">Pr√©nom requis</mat-error>
    </mat-form-field>

    <!-- ADRESSE -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Rue</mat-label>
      <input
        matInput
        [matAutocomplete]="auto"
        formControlName="address"
      />
      <mat-autocomplete #auto="matAutocomplete" (optionSelected)="setAddressFields($event.option.value)">
        <mat-option *ngFor="let suggestion of filteredStreets | async" [value]="suggestion">
          {{ suggestion.label }}
        </mat-option>
      </mat-autocomplete>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Ville</mat-label>
      <input matInput formControlName="city" readonly />
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Code Postal</mat-label>
      <input matInput formControlName="postaleCode" readonly />
    </mat-form-field>

    <!-- S√âCURIT√â SOCIALE -->
    <mat-form-field appearance="outline">
      <mat-label>Num√©ro de s√©curit√© sociale</mat-label>
      <input matInput formControlName="numSec" type="text" />
      <mat-error *ngIf="form.get('numSec')?.hasError('pattern')">15 chiffres requis</mat-error>
      <mat-error *ngIf="form.get('numSec')?.hasError('duplicate')">Ce num√©ro est d√©j√† utilis√©.</mat-error>
    </mat-form-field>

    <!-- R√îLE ET STATUT -->
    <mat-form-field appearance="outline">
      <mat-label>R√¥le</mat-label>
      <mat-select formControlName="role">
        <mat-option value="dirigeant">Dirigeant</mat-option>
        <mat-option value="administrateur">Administrateur</mat-option>
        <mat-option value="gerant">G√©rant</mat-option>
        <mat-option value="technicien">Technicien</mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Statut</mat-label>
      <mat-select formControlName="status">
        <mat-option value="auto-entrepreneur">Auto-entrepreneur</mat-option>
        <mat-option value="salari√©">Salari√©</mat-option>
      </mat-select>
    </mat-form-field>

    <!-- SIRET uniquement pour auto-entrepreneur -->
    <mat-form-field appearance="outline" *ngIf="isAutoEntrepreneur">
      <mat-label>Num√©ro de SIRET</mat-label>
      <input matInput formControlName="numSiret" type="text" />
      <mat-error *ngIf="form.get('numSiret')?.hasError('required')">Champ requis</mat-error>
      <mat-error *ngIf="form.get('numSiret')?.hasError('pattern')">14 chiffres requis</mat-error>
      <mat-error *ngIf="form.get('numSiret')?.hasError('duplicate')">SIRET d√©j√† utilis√©</mat-error>
    </mat-form-field>

    <!-- AFFECTATION D√âP√îT & CAMIONNETTE -->
    <mat-form-field appearance="outline">
      <mat-label>D√©p√¥t rattach√©</mat-label>
      <mat-select formControlName="idDep">
        <mat-option *ngFor="let d of depots()" [value]="d.idDep">{{ d.name }}</mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Camionnette attribu√©e</mat-label>
      <mat-select formControlName="idVeh">
        <mat-option *ngFor="let v of vehicules()" [value]="v.idVeh">
          {{ v.brand }} - {{ v.registrationPlate }}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <!-- CONTACT -->
    <mat-form-field appearance="outline">
      <mat-label>T√©l√©phone</mat-label>
      <input matInput formControlName="phone" />
      <mat-error *ngIf="form.get('phone')?.hasError('pattern')">Num√©ro invalide</mat-error>
      <mat-error *ngIf="form.get('phone')?.hasError('duplicate')">T√©l√©phone d√©j√† utilis√©</mat-error>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Email</mat-label>
      <input matInput formControlName="email" type="email" />
      <mat-error *ngIf="form.get('email')?.hasError('email')">Format invalide</mat-error>
      <mat-error *ngIf="form.get('email')?.hasError('duplicate')">Email d√©j√† utilis√©</mat-error>
    </mat-form-field>

    <!-- ACTIONS -->
    <div class="form-actions">
      <button mat-stroked-button type="button" (click)="form.reset()">Annuler</button>
      <button mat-raised-button color="primary" type="submit" [disabled]="form.invalid">
        Ajouter
      </button>
    </div>
  </form>
</mat-card>
