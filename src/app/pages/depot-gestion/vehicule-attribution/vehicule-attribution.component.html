<mat-card class="vehicule-attribution-container">

    <mat-card-title>ğŸ“¦ Gestion du dÃ©pÃ´t nÂ°{{ depotId() }}</mat-card-title>

    <mat-card-title>ğŸš— Attribution des vÃ©hicules</mat-card-title>
    <mat-card-content class="vehicule-attribution-content">

        <!-- Techniciens -->
        <div class="tech-list">
            <h3>ğŸ‘· Techniciens rattachÃ©s</h3>
            <div *ngIf="technicians().length === 0">Aucun technicien trouvÃ©.</div>

            <mat-card *ngFor="let tech of technicians()" class="tech-card">
                <div class="tech-info">
                    <span>{{ tech.prename }} {{ tech.name }}</span>
                </div>

                <div class="tech-actions">
                    <!-- âœ… Attribuer si pas encore de vÃ©hicule -->
                    <ng-container *ngIf="!hasVehicule(tech) && getVehiculesDisponibles().length > 0">
                        <button
                                (click)="attribuerVehicule(veh, tech)"
                                *ngFor="let veh of getVehiculesDisponibles()"
                                color="primary"
                                mat-stroked-button>
                            ğŸš— Attribuer {{ veh.brand }}
                        </button>
                    </ng-container>

                    <ng-container *ngIf="!hasVehicule(tech) && getVehiculesDisponibles().length === 0">
                        <span class="no-vehicule-msg">Aucun vÃ©hicule disponible Ã  attribuer</span>
                    </ng-container>

                    <!-- â™»ï¸ Reprendre si un vÃ©hicule est affectÃ© -->
                    <ng-container *ngIf="vehiculeAffecte(tech) as veh">
                        <button
                                (click)="reprendreVehicule(veh)"
                                color="warn"
                                mat-stroked-button>
                            â™»ï¸ Retirer {{ veh.brand }}
                        </button>
                    </ng-container>
                </div>
            </mat-card>
        </div>

        <!-- VÃ©hicules -->
        <div class="veh-list">
            <h3>ğŸšš VÃ©hicules du dÃ©pÃ´t</h3>
            <div *ngIf="vehicules().length === 0">Aucun vÃ©hicule disponible.</div>

            <mat-card *ngFor="let veh of vehicules()" class="vehicule-card">
                <div class="vehicule-info">
                    <strong>{{ veh.brand }}</strong>
                    <div>ğŸ“ Immatriculation : {{ veh.registrationPlate }}</div>
                    <div>ğŸ‘¤ AffectÃ© Ã  : {{ getNomTechnicien(veh.idTec) }}</div>
                </div>

                <div class="vehicule-actions">
                    <button
                            (click)="reprendreVehicule(veh)"
                            *ngIf="veh.idTec"
                            color="accent"
                            mat-raised-button>
                        â™»ï¸ Reprendre
                    </button>
                </div>
            </mat-card>
        </div>

    </mat-card-content>
</mat-card>
