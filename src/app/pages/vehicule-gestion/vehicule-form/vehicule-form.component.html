<mat-card class="mat-elevation-z4 max-w-md mx-auto p-6 rounded-xl">
  <mat-card-title>Ajouter un véhicule</mat-card-title>
  <mat-card-content>
    <form [formGroup]="vehiculeForm" (ngSubmit)="submit()" class="space-y-4">

      <!-- Immatriculation -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Immatriculation *</mat-label>
        <input matInput formControlName="registrationPlate" required />
        <mat-error *ngIf="vehiculeForm.get('registrationPlate')?.hasError('required') && vehiculeForm.get('registrationPlate')?.touched">
          Ce champ est requis
        </mat-error>
        <mat-error *ngIf="vehiculeForm.get('registrationPlate')?.hasError('pattern') && vehiculeForm.get('registrationPlate')?.touched">
          Format attendu : ab-123-cd
        </mat-error>
        <mat-error *ngIf="vehiculeForm.get('registrationPlate')?.hasError('registrationExists') && vehiculeForm.get('registrationPlate')?.touched">
          Ce numéro est déjà utilisé
        </mat-error>
      </mat-form-field>

      <!-- Marque -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Marque</mat-label>
        <mat-select formControlName="brand" (selectionChange)="onBrandChange($event.value)">
          <mat-option *ngFor="let brand of brands" [value]="brand">{{ brand }}</mat-option>
        </mat-select>
      </mat-form-field>

      <!-- Modèle -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Modèle</mat-label>
        <mat-select formControlName="model">
          <mat-option *ngFor="let model of availableModels" [value]="model">{{ model }}</mat-option>
        </mat-select>
      </mat-form-field>

      <!-- Etat -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>État</mat-label>
        <mat-select formControlName="buyState">
          <mat-option value="neuf">Neuf</mat-option>
          <mat-option value="bon">Bon</mat-option>
          <mat-option value="maintenance">Maintenance</mat-option>
        </mat-select>
      </mat-form-field>

      <!-- Description -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Description</mat-label>
        <input matInput formControlName="description" />
      </mat-form-field>

      <!-- Statut -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Statut</mat-label>
        <mat-select formControlName="status">
          <mat-option value="depot">Dépôt</mat-option>
          <mat-option value="technician">Technicien</mat-option>
        </mat-select>
      </mat-form-field>

      <!-- Depot -->
      <mat-form-field
        *ngIf="vehiculeForm.value.status === 'depot'"
        appearance="outline"
        class="full-width"
      >
        <mat-label>Dépôt assigné</mat-label>
        <mat-select formControlName="idDep">
          <mat-option *ngFor="let dep of depots()" [value]="dep.idDep">
            {{ dep.name }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <!-- Technicien -->
      <mat-form-field
        *ngIf="vehiculeForm.value.status === 'technician'"
        appearance="outline"
        class="full-width"
      >
        <mat-label>Technicien assigné</mat-label>
        <mat-select formControlName="assignedTo">
          <mat-option *ngFor="let tech of technicians()" [value]="tech.idUser">
            {{ tech.name }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <div class="text-right">
        <button mat-raised-button color="primary" type="submit">
          Enregistrer
        </button>
      </div>

    </form>
  </mat-card-content>
</mat-card>
